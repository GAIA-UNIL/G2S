<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WTZCWGE9PT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WTZCWGE9PT',{ 'anonymize_ip': true });
</script>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/G2S/assets/css/style.css?v=" media="screen" type="text/css">
    <link rel="stylesheet" href="/G2S/assets/css/print.css" media="print" type="text/css">
    <link rel="stylesheet" href="/G2S/assets/css/g2s.css" media="screen" type="text/css">

    <script src="/G2S/assets/js/tabManager.js"></script>
    <script src="/G2S/assets/js/codeblock.js"></script>

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>QuickSampling | G2S: The GeoStatistical Server</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="QuickSampling" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A free and flexible multiple point (geo)statistics framework including state-of-the-art algorithms: QuickSampling and Narrow Distribution Selection" />
<meta property="og:description" content="A free and flexible multiple point (geo)statistics framework including state-of-the-art algorithms: QuickSampling and Narrow Distribution Selection" />
<link rel="canonical" href="https://gaia-unil.github.io//G2S/algorithms/QuickSampling.html" />
<meta property="og:url" content="https://gaia-unil.github.io//G2S/algorithms/QuickSampling.html" />
<meta property="og:site_name" content="G2S: The GeoStatistical Server" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-13T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="QuickSampling" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-13T00:00:00+00:00","datePublished":"2023-03-13T00:00:00+00:00","description":"A free and flexible multiple point (geo)statistics framework including state-of-the-art algorithms: QuickSampling and Narrow Distribution Selection","headline":"QuickSampling","mainEntityOfPage":{"@type":"WebPage","@id":"https://gaia-unil.github.io//G2S/algorithms/QuickSampling.html"},"url":"https://gaia-unil.github.io//G2S/algorithms/QuickSampling.html"}</script>
<!-- End Jekyll SEO tag -->


    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'G-WTZCWGE9PT', 'auto');
    ga('send', 'pageview');
  </script>



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/G2S/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="https://gaia-unil.github.io//G2S/">
          <h1>G2S: The GeoStatistical Server</h1>
        </a>
        <h2>A free and flexible multiple point (geo)statistics framework including state-of-the-art algorithms: QuickSampling and Narrow Distribution Selection</h2>
        <div class="githubButton">
          
          <a href="https://github.com/GAIA-UNIL/G2S" class="button"><small>View project on</small> GitHub</a>
        
        
          <a href="https://github.com/GAIA-UNIL/G2S/zipball/master" class="button download"><small>Download</small>
              .zip file</a>
        
        
          <a href="https://github.com/GAIA-UNIL/G2S/tarball/master" class="button download"><small>Download</small>
              .tar.gz file</a>
        
        
        </div>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <aside id="menuSidebar" class="sideMenuBar">
          <nav class="navBar sideMenu">
          
          
          













<ul class="main">
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/briefOverview.html">Brief overview</a>

      
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class=" sub">
      <a href="/G2S/installation.html">Installation</a>

      
        
        













<ul class="main">
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/installation/server.html">Installation of the server</a>

      
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/installation/interfaces.html">Installation of interfaces</a>

      
        
      
    </li>
  
</ul>

      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/runTheServer.html">Run the server</a>

      
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/usingTheInterfaces.html">Using the interfaces</a>

      
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class=" sub">
      <a href="/G2S/algorithms.html">Algorithms</a>

      
        
        













<ul class="main">
  
    
    
    
    
    
    
    

    
      
    

        <li class="selected ">
      <a href="/G2S/algorithms/QuickSampling.html">QuickSampling</a>

      
        
          <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#parameters-for-qs">Parameters for QS</a>
<ul>
<li class="toc-entry toc-h3"><a href="#advanced-parameters">Advanced parameters</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#examples">Examples</a>
<ul>
<li class="toc-entry toc-h3"><a href="#unconditional-simulation">Unconditional simulation</a></li>
<li class="toc-entry toc-h3"><a href="#conditional-simulation">Conditional simulation</a></li>
<li class="toc-entry toc-h3"><a href="#simulation-with-multiple-training-images">Simulation with multiple Training Images</a></li>
<li class="toc-entry toc-h3"><a href="#multivariate-simulation">Multivariate simulation</a></li>
<li class="toc-entry toc-h3"><a href="#gap-filling">Gap filling</a></li>
<li class="toc-entry toc-h3"><a href="#downscaling">Downscaling</a></li>
<li class="toc-entry toc-h3"><a href="#3d-simulation">3D simulation</a></li>
<li class="toc-entry toc-h3"><a href="#asynchronous-mode">Asynchronous mode</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#publication">Publication</a></li>
<li class="toc-entry toc-h2"><a href="#benchmarking">Benchmarking</a></li>
<li class="toc-entry toc-h2"><a href="#advanced">Advanced</a>
<ul>
<li class="toc-entry toc-h3"><a href="#multiple-realization">Multiple realization</a></li>
<li class="toc-entry toc-h3"><a href="#how-to-do-a-simulation-by-segment">How to do a simulation by segment</a></li>
</ul>
</li>
</ul>
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/algorithms/NarrowDistributionSelection.html">Narrow Distribution Selection</a>

      
        
      
    </li>
  
    
    
    
    
    
    
    

    
      
    

        <li class="">
      <a href="/G2S/algorithms/AutoQS.html">AutoQS</a>

      
        
      
    </li>
  
</ul>

      
    </li>
  
</ul>

          
          
          </nav>
        </aside>
        <section id="main-content">
          <h1 id="quicksampling-qs">QuickSampling QS</h1>

<h2 id="parameters-for-qs">
<a class="anchor" href="#parameters-for-qs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters for QS</h2>

<p>Usage: <code class="language-plaintext highlighter-rouge">[sim,index,time,finalprogress,jobid] = g2s(flag1,value1, flag2,value2, ...)</code>
Outputs: sim = simulation, index = index of the simulated values in the flattened TI, time = simulation time, finalprogress = final progression of the simulation (normally 100), jobid = job ID.</p>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Description</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-ti</code></td>
      <td>Training images (one or more images). If multivariate, the last dimension should be the same size as the number of variables, and should also match the size of the array given for the parameter dt. NaN values in the training image will be ignored. Unlike other MPS-algorithms, if there are multiple variables they will not be automatically normalized to be in the same range.</td>
      <td>✔</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-di</code></td>
      <td>Destination image (one image, aka simulation grid). The size of di will be the size of the simulation grid. di can be identical as ti for gap-filing. NaN values will be simulated. Non-NaN values will be considered as conditioning data.</td>
      <td>✔</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-dt</code></td>
      <td>Data type. 0 → continuous and 1 → categorical. <red>This is where the number of variables is defined.</red> Provide a list containing zeros or ones representing the data type of each variable.</td>
      <td>✔</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-k</code></td>
      <td>Number of best candidates to consider ∈ [1 ∞].</td>
      <td>✔</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-n</code></td>
      <td>N closest neighbors to consider. If multiple variables: use a single N value if identical for all variables or use an array of N values if each variable has a different N.</td>
      <td>✔</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-ki</code></td>
      <td>Image of the weighting kernel. Although the use of a kernel is optional, it is highly recommended to specify one. The size of the kernel is also the size of the search neighborhood. The weights in the kernel can be used to normalize the variables. If multiple variables: use a single kernel value if identical for all variables or if each variable has a different kernel, stack all kernels along the last dimension. The number of kernels should then match the size of the array given for the parameter dt. Possibility to use different kernels for different parts of the simulation with the “-kii” parameter explained below.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-j</code></td>
      <td>To run in parallel (default is single core). To use as follows ‘-j’, N1, N2, N3 (all three are optional but N3 needs N2, which in turn needs N1). Use integer values to specify a number of threads (or logical cores). Use decimal values ∈]0,1[ to indicate fraction of the maximum number of available logical cores (e.g., 0.5=50% of all available logical cores). N1 threads used to parallelize the path (path-level) Default: the maximum number of threads available. N2 threads used to parallelize over training images (if many TIs are available, each is scanned on a different core). Default: 1. N3 threads used to parallelize FFTs (node-level). Default: 1. N1 and N2 are recommended over N3. N1 is usually more efficient than N2, but requires more memory.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-sp</code></td>
      <td>Simulation path, array of the size of the simulation grid containing values that specify the simulation path (from low to high). Default is a random path. Equal values are accepted but will always be ordered in the same way (i.e. not random). -∞ values are not simulated. In case of multiple variables, a vector simulation is default (same path for all variables) and the simulation path should be one dimension less than the number of variables. If you prefer a full simulation, provide an array containing the path for each variable and use the “-fs” flag below.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-s</code></td>
      <td>Random seed value.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-W_GPU</code></td>
      <td>Use integrated GPU if available.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-W_CUDA</code></td>
      <td>Use Nvidia Cuda compatible GPU: specify the device id. (e.g., <code>'-W_CUDA',0,1</code> to use the first two GPUs).</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="advanced-parameters">
<a class="anchor" href="#advanced-parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced parameters</h3>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Description</th>
      <th>Mandatory</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-ii</code></td>
      <td>Array that specifies for each pixel which training image to sample from. Default: all training images are searched for the best match.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-kii</code></td>
      <td>Array that specifies for each pixel which kernel to use. Useful if you want different weight fields when simulating different parts of the di, or if you want certain covariables to only influence parts of your di (e.g. you want a surface variable to only influence the simulation of the top subsurface layer). Usage: provide a list of full kernels in -ki, and only a single image for -kii to specify which full kernel to use at which pixel.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-ni</code></td>
      <td>Array that specifies for each pixel which the number of neighbors.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-kvi</code></td>
      <td>Array that specifies for each pixel which the number of best candidates to consider.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-far</code></td>
      <td>Fast and risky 😄, like -ii but with a random input (experimental).</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-cti</code></td>
      <td>With this flag QS will treat the training image(s) as periodic (aka circular or cyclic) over each dimension.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-csim</code></td>
      <td>With this flag QS will make sure to create a periodic (aka circular or cyclic) simulation over each dimension.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-adsim</code></td>
      <td>Augmented dimentionality simulation: allows for 3D simulation using 2D training image, only for categories (Coming maybe some day!).</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-fs</code></td>
      <td>Full simulation: follows a different simulation path for each variable (as opposed to vector simulation, where the same simulation path is used for all variables).</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-f</code></td>
      <td>f=1/k equivalent to f of DS with a threshold to 0.</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-nV</code></td>
      <td>No Verbatim, i.e. prohibits neighbors in the training image to be neighbors in the simulation. (experimental).</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--forceSimulation</code></td>
      <td>Restimulate a value even if already existing.</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2 id="examples">
<a class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>
<p>Below are several examples showcasing different applications of QS. For these examples the G2S server should be installed and running, either on your own machine or remotely. A Google Colab notebook with more examples and an automatic installation of G2S can be found <a href="https://github.com/GAIA-UNIL/Short-course-MPS/blob/main/MPS_SC_with_QS_Online.ipynb">here</a>.</p>

<h3 id="unconditional-simulation">
<a class="anchor" href="#unconditional-simulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unconditional simulation</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># load example training image ('stone')
</span><span class="n">ti</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">)));</span>

<span class="c1"># QS call using G2S
</span><span class="n">simulation</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#Zero for continuous variables
</span>                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">#Display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Unconditional simulation'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%load data</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">);</span>

<span class="c1">% QS call using G2S</span>
<span class="n">simulation</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">%Display results </span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'Unconditional simulation'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>

<h3 id="conditional-simulation">
<a class="anchor" href="#conditional-simulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conditional simulation</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># load example training image ('stone')
</span><span class="n">ti</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">)));</span>

<span class="c1"># create empty grid and add conditioning data
</span><span class="n">conditioning</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">;</span> 
<span class="c1"># fill the grid with 50 random points
</span><span class="n">conditioning</span><span class="p">.</span><span class="n">flat</span><span class="p">[</span><span class="n">numpy</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">conditioning</span><span class="p">.</span><span class="n">size</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]]</span><span class="o">=</span><span class="n">ti</span><span class="p">.</span><span class="n">flat</span><span class="p">[</span><span class="n">numpy</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">ti</span><span class="p">.</span><span class="n">size</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]];</span>

<span class="c1"># QS call using G2S
</span><span class="n">simulation</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span> 
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">conditioning</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1"># Display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s">'aspect'</span><span class="p">:</span><span class="s">'equal'</span><span class="p">})</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Conditional simulation'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span><span class="n">numpy</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">conditioning</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">'.'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Conditioning'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%load data</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">);</span>
<span class="c1">% empty grid </span>
<span class="n">conditioning</span><span class="o">=</span><span class="n">nan</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> 
<span class="c1">% fill the grid with 50 random points</span>
<span class="n">conditioning</span><span class="p">(</span><span class="nb">randperm</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">conditioning</span><span class="p">),</span><span class="mi">50</span><span class="p">))</span><span class="o">=</span><span class="n">ti</span><span class="p">(</span><span class="nb">randperm</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">ti</span><span class="p">),</span><span class="mi">50</span><span class="p">));</span>

<span class="c1">% QS call using G2S</span>
<span class="n">simulation</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">conditioning</span><span class="p">,</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">%Display results </span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'Conditional simulation'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">conditioning</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Conditioning'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>

<h3 id="simulation-with-multiple-training-images">
<a class="anchor" href="#simulation-with-multiple-training-images" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simulation with multiple Training Images</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1">#ti1 contains horizontal lines and ti2 vertical lines
</span><span class="n">ti1</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">)),(</span><span class="mi">150</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ti2</span> <span class="o">=</span> <span class="n">ti1</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="c1"># QS call using only the horizontal lines as TI
</span><span class="n">simulation1</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                         <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti1</span><span class="p">,</span>
                         <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                         <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">1</span><span class="p">],</span> <span class="c1">#1 for categorical variable
</span>                         <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                         <span class="s">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>
                         <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1"># QS call using both horizontal and vertical lines as TI's
</span><span class="n">simulation2</span><span class="p">,</span><span class="n">index2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                         <span class="s">'-ti'</span><span class="p">,[</span><span class="n">ti1</span><span class="p">,</span><span class="n">ti2</span><span class="p">],</span>
                         <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                         <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                         <span class="s">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>
                         <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">#Display results
</span><span class="n">fig</span><span class="p">,</span> <span class="p">([[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">],[</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">]])</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">sharex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Multiple TI simulation'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti1</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image 1'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti2</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image 2'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation1</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation 1'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation2</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation 2'</span><span class="p">);</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%ti1 contains horizontal lines and ti2 vertical lines</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">repmat</span><span class="p">((</span><span class="nb">sin</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">150</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">150</span><span class="p">);</span>
<span class="n">ti1</span><span class="o">=</span><span class="n">ti</span><span class="p">;</span>
<span class="n">ti2</span><span class="o">=</span><span class="nb">rot90</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">%QS call using only the horizontal lines as TI</span>
<span class="n">simulation1</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="k">...</span>
            <span class="s1">'-ti'</span><span class="p">,{</span><span class="n">ti1</span><span class="p">},</span> <span class="k">...</span>
            <span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">1</span><span class="p">],</span> <span class="k">...</span>
            <span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">% QS call using both horizontal and vertical lines as TI's</span>
<span class="n">simulation2</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="k">...</span>
            <span class="s1">'-ti'</span><span class="p">,{</span><span class="n">ti1</span> <span class="n">ti2</span><span class="p">},</span> <span class="k">...</span>
            <span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">1</span><span class="p">],</span> <span class="k">...</span>
            <span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">%Display results </span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="nb">clf</span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'multi-TI'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti1</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image 1'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti2</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image 2'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation1</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation with training image 1'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation2</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation with training images 1 and 2'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>

<h3 id="multivariate-simulation">
<a class="anchor" href="#multivariate-simulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multivariate simulation</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="n">tf</span>

<span class="n">ti</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/ti_3_variables.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">))</span>

<span class="c1">###Example 1 - Complete multivariate simulation
#Here all three variables are entirely unkwown and will be simulated simultaneously
</span>
<span class="c1"># QS call using G2S (with dt set to two continuous and one categorical variable)
</span><span class="n">simulation1</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">#Display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">([[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">],[</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span><span class="p">,</span><span class="n">ax6</span><span class="p">],[</span><span class="n">ax7</span><span class="p">,</span><span class="n">ax8</span><span class="p">,</span><span class="n">ax9</span><span class="p">]])</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">sharex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Multivariate simulation - example 2'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 1'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 2'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 3'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 1'</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 2'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 3'</span><span class="p">)</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation1</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 1'</span><span class="p">);</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation1</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 2'</span><span class="p">);</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation1</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 3'</span><span class="p">);</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>



<span class="c1">### Example 2 - Multivariate simulation with partially informed covariables
#In many situations we will have fully and/or partially informed covariables (e.g. topography + point measurements)
#To simulate a different environment than the training images, we will use the results from example 1 above
#Variable 2 is partially informed and variable 3 is fully informed
</span>
<span class="c1">#Take random values from the previous simulation of variable 2 and add them to the di
</span><span class="n">di_var2</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span>
<span class="n">di_var2</span><span class="p">.</span><span class="n">flat</span><span class="p">[</span><span class="n">numpy</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">di_var2</span><span class="p">.</span><span class="n">size</span><span class="p">)[:</span><span class="mi">500</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ti</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">].</span><span class="n">flat</span><span class="p">[</span><span class="n">numpy</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">].</span><span class="n">size</span><span class="p">)[:</span><span class="mi">500</span><span class="p">]]</span>
<span class="n">di_example2</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">stack</span><span class="p">([</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                                 <span class="n">di_var2</span><span class="p">,</span>
                                 <span class="n">simulation1</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># QS call using G2S (with dt set to two continuous and one categorical variable)
</span><span class="n">simulation2</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">di_example2</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">#Display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">([[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">],[</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span><span class="p">,</span><span class="n">ax6</span><span class="p">],[</span><span class="n">ax7</span><span class="p">,</span><span class="n">ax8</span><span class="p">,</span><span class="n">ax9</span><span class="p">]])</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">sharex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Multivariate simulation - example 2'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 1'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 2'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image dim 3'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">di_example2</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 1'</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">numpy</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">di_example2</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s">'.'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 2'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">ax5</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">di_example2</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Destination image dim 3'</span><span class="p">)</span>
<span class="n">ax6</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation2</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 1'</span><span class="p">);</span>
<span class="n">ax7</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation2</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 2'</span><span class="p">);</span>
<span class="n">ax8</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation2</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation dim 3'</span><span class="p">);</span>
<span class="n">ax9</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>


</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%load data</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/ti_3_variables.tiff'</span><span class="p">);</span>

<span class="c1">% QS call using G2S (with dt set to two continuous and one categorical</span>
<span class="c1">% variable)</span>
<span class="n">simulation</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">%Display results </span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'Unconditional simulation'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image dim 1'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image dim 2'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image dim 3'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation dim 1'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation dim 2'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation dim 3'</span><span class="p">);</span>
<span class="nb">colormap</span> <span class="nb">winter</span><span class="p">;</span>

</code></pre></div>  </div>
</div>

<h3 id="gap-filling">
<a class="anchor" href="#gap-filling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gap filling</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># load example training image ('stone') and cut out a part of it
</span><span class="n">tiWithGap</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">)));</span>
<span class="n">tiWithGap</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">140</span><span class="p">,</span><span class="mi">60</span><span class="p">:</span><span class="mi">140</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">;</span>

<span class="c1"># QS call using G2S
</span><span class="n">simulation</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">tiWithGap</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">tiWithGap</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">#Display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Gap filling'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tiWithGap</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%load data</span>
<span class="n">tiWithGap</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">);</span>
<span class="n">tiWithGap</span><span class="p">(</span><span class="mi">60</span><span class="p">:</span><span class="mi">140</span><span class="p">,</span><span class="mi">60</span><span class="p">:</span><span class="mi">140</span><span class="p">)</span><span class="o">=</span><span class="n">nan</span><span class="p">;</span>

<span class="c1">% QS call using G2S</span>
<span class="n">simulation</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">tiWithGap</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">tiWithGap</span><span class="p">,</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">%Display results </span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'Gap filling'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">tiWithGap</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>

<h3 id="downscaling">
<a class="anchor" href="#downscaling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Downscaling</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1">#Load example training image "Dunes gobi"
</span><span class="n">ti_full</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/dunes_gobi.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">))</span>
<span class="c1">#Keep one version at fine resolution
</span><span class="n">ti_fine</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">ti_full</span><span class="p">)</span>
<span class="c1">#Make a synthetic coarse resolution image by upscaling and reprojecting to the original grid 
</span><span class="n">ti_coarse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">ti_full</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span>
    <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ti_full</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">ti_full</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="mi">5</span><span class="p">))).</span><span class="n">resize</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ti_full</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">ti_full</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="n">resample</span><span class="o">=</span><span class="n">Image</span><span class="p">.</span><span class="n">NEAREST</span><span class="p">))</span>

<span class="c1">#Display the full training image at both resolutions
</span><span class="n">norm</span> <span class="o">=</span><span class="n">colors</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ti_fine</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">ti_fine</span><span class="p">.</span><span class="nb">max</span><span class="p">())</span>
<span class="n">f</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti_fine</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Fine resolution training image'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti_coarse</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Coarse resolution training image'</span><span class="p">)</span>

<span class="c1">#Crop half of the image to be used as ti
</span><span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">stack</span><span class="p">((</span><span class="n">ti_fine</span><span class="p">[:</span><span class="mi">500</span><span class="p">,:</span><span class="mi">500</span><span class="p">],</span><span class="n">ti_coarse</span><span class="p">[:</span><span class="mi">500</span><span class="p">,:</span><span class="mi">500</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#Crop upper right corner to be used as di
</span><span class="n">di_coarse</span> <span class="o">=</span> <span class="n">ti_coarse</span><span class="p">[:</span><span class="mi">200</span><span class="p">,</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span>
<span class="n">di_fine</span>   <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span>
<span class="n">di</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">stack</span><span class="p">((</span><span class="n">di_fine</span><span class="p">,</span><span class="n">di_coarse</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#dt consists of two zeros representing two continuous variables
</span><span class="n">dt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ti</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># QS call using G2S
</span><span class="n">simulation</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                         <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                         <span class="s">'-di'</span><span class="p">,</span><span class="n">di</span><span class="p">,</span>
                         <span class="s">'-dt'</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span>
                         <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span>
                         <span class="s">'-n'</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span>
                         <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1">#Display results 
</span><span class="n">norm</span> <span class="o">=</span><span class="n">colors</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ti_fine</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span><span class="n">vmax</span><span class="o">=</span><span class="n">ti_fine</span><span class="p">.</span><span class="nb">max</span><span class="p">())</span>
<span class="n">f</span><span class="p">,((</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">),(</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Downscaling'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">di_coarse</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Coarse res di'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simulation</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">norm</span> <span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation'</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Index'</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti_fine</span><span class="p">[:</span><span class="mi">200</span><span class="p">,</span><span class="o">-</span><span class="mi">200</span><span class="p">:],</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'True image'</span><span class="p">)</span>
<span class="n">ax4</span><span class="p">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ti_full</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span><span class="n">ti_full</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">25</span><span class="p">));</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%load example training image 'Dunes gobi'</span>
<span class="n">ti_fine</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/dunes_gobi.tiff'</span><span class="p">);</span>

<span class="c1">%create an artificial coarse resolution image on the same grid </span>
<span class="n">ti_coarse</span> <span class="o">=</span> <span class="nb">imresize</span><span class="p">(</span><span class="nb">imresize</span><span class="p">(</span><span class="n">ti_fine</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="s1">'nearest'</span><span class="p">),</span><span class="mi">5</span><span class="p">,</span><span class="s1">'nearest'</span><span class="p">);</span>

<span class="c1">%display the full training image at both resolutions</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">tiledlayout</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">ti_fine</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Fine TI'</span><span class="p">);</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">ti_coarse</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Coarse TI'</span><span class="p">);</span>

<span class="n">ti_size</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
<span class="n">di_size</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

<span class="c1">%crop half of the image, to be used as ti</span>
<span class="n">ti</span> <span class="o">=</span> <span class="nb">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ti_fine</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ti_size</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ti_size</span><span class="p">),</span><span class="n">ti_coarse</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ti_size</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">ti_size</span><span class="p">));</span>
<span class="c1">%crop upper right corner to be used as di</span>
<span class="n">di_coarse</span> <span class="o">=</span> <span class="n">ti_coarse</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">di_size</span><span class="p">,(</span><span class="k">end</span><span class="o">-</span><span class="n">di_size</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="k">end</span><span class="p">);</span>
<span class="n">di_fine</span>  <span class="o">=</span> <span class="n">nan</span><span class="p">(</span><span class="n">di_size</span><span class="p">,</span><span class="n">di_size</span><span class="p">);</span>
<span class="n">di</span> <span class="o">=</span> <span class="nb">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">di_fine</span><span class="p">,</span><span class="n">di_coarse</span><span class="p">);</span>


<span class="c1">% QS call using G2S</span>
<span class="p">[</span><span class="n">simulation</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="nb">time</span><span class="p">]</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="k">...</span>
                <span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="k">...</span>
                <span class="s1">'-di'</span><span class="p">,</span><span class="n">di</span><span class="p">,</span><span class="k">...</span>
                <span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">],</span><span class="k">...</span><span class="c"> #Zero for continuous variables</span>
                <span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="k">...</span>
                <span class="s1">'-n'</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="k">...</span>
                <span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="nb">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">tiledlayout</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">di_coarse</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Coarse DI'</span><span class="p">);</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">simulation</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation'</span><span class="p">);</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">index</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">),</span><span class="s1">'CDataMapping'</span><span class="p">,</span><span class="s1">'scaled'</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Index'</span><span class="p">);</span>
<span class="n">nexttile</span><span class="p">;</span>
<span class="nb">image</span><span class="p">(</span><span class="n">ti_fine</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">di_size</span><span class="p">,(</span><span class="k">end</span><span class="o">-</span><span class="n">di_size</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="k">end</span><span class="p">));</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'True image'</span><span class="p">);</span>



</code></pre></div>  </div>
</div>

<h3 id="3d-simulation">
<a class="anchor" href="#3d-simulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>3D simulation</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">tifffile</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="c1">#Load example boolean training image "Damier 3D" and crop it to reduce computational requirements
</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/Damier3D.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">))[:</span><span class="n">dim</span><span class="p">,:</span><span class="n">dim</span><span class="p">,:</span><span class="n">dim</span><span class="p">]</span>

<span class="c1"># QS call using G2S
</span><span class="n">simulation</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span>
                             <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                             <span class="s">'-di'</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                             <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">1</span><span class="p">],</span> <span class="c1">#1 for categorical variables
</span>                             <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                             <span class="s">'-n'</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>

<span class="c1">#Display results
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">voxels</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">'tab:blue'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'3D Training image'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">voxels</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">'tab:blue'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'QS 3D simulation'</span><span class="p">)</span>

<span class="c1">#Display the indices of the ti-values found in the di-image
</span><span class="n">viridis</span> <span class="o">=</span> <span class="n">cm</span><span class="p">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">'viridis'</span><span class="p">,</span><span class="n">index</span><span class="p">.</span><span class="nb">max</span><span class="p">())</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="n">viridis</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">voxels</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">facecolors</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="mi">45</span><span class="p">);</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">%% 3D multivariate</span>

<span class="nb">clear</span><span class="p">;</span><span class="nb">home</span><span class="p">;</span><span class="nb">clf</span>
<span class="c1">%download TI (first variable, continuous)</span>
<span class="n">ti1</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/fold_continuous.tiff'</span><span class="p">);</span>
<span class="c1">%create second variable (categorical) by thresholding the first</span>
<span class="n">ti2</span><span class="o">=</span><span class="n">ti1</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">;</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">cat</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">ti1</span><span class="p">,</span><span class="n">ti2</span><span class="p">);</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">double</span><span class="p">(</span><span class="n">ti</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="mi">101</span><span class="p">:</span><span class="mi">120</span><span class="p">,:));</span>

<span class="c1">%display TI</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">ti</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">),[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">2</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">1</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="nb">shading</span> <span class="n">flat</span>
<span class="nb">camproj</span><span class="p">(</span><span class="s1">'perspective'</span><span class="p">)</span>
<span class="nb">axis</span> <span class="n">equal</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'TI variable 1'</span><span class="p">);</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">ti</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">),[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">2</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">1</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="nb">shading</span> <span class="n">flat</span>
<span class="nb">camproj</span><span class="p">(</span><span class="s1">'perspective'</span><span class="p">)</span>
<span class="nb">axis</span> <span class="n">equal</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'TI variable 2'</span><span class="p">);</span>

<span class="c1">% QS call using G2S</span>
<span class="nb">tic</span>
<span class="n">simulation</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,{</span><span class="mi">20</span> <span class="mi">10</span><span class="p">},</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="nb">toc</span>

<span class="c1">%display simulation</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">simulation</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">),[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">2</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">1</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="nb">shading</span> <span class="n">flat</span>
<span class="nb">camproj</span><span class="p">(</span><span class="s1">'perspective'</span><span class="p">)</span>
<span class="nb">axis</span> <span class="n">equal</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation variable 1'</span><span class="p">);</span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">3</span><span class="p">));</span>
<span class="nb">slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">simulation</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">),[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">2</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">1</span><span class="p">)],[</span><span class="mi">1</span> <span class="nb">size</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="nb">shading</span> <span class="n">flat</span>
<span class="nb">camproj</span><span class="p">(</span><span class="s1">'perspective'</span><span class="p">)</span>
<span class="nb">axis</span> <span class="n">equal</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation variable 2'</span><span class="p">);</span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'3D Simulation with two variables'</span><span class="p">);</span>

</code></pre></div>  </div>
</div>

<h3 id="asynchronous-mode">
<a class="anchor" href="#asynchronous-mode" aria-hidden="true"><span class="octicon octicon-link"></span></a>Asynchronous mode</h3>

<div class="tab code">
  <p><button class="tablinks python" onclick="openTab(event, 'python', 'interface')">
    <img src="/G2S/assets/images/Python.svg" alt="Python">
  </button>
  <button class="tablinks matlab" onclick="openTab(event, 'matlab', 'interface')">
    <img src="/G2S/assets/images/Matlab.png" alt="Matlab">
  </button>
<!--   <button class="tablinks" onclick="openTab(event, 'R', 'interface')">
    <img src="/G2S/assets/images/Rlogo.svg" alt="R">
  </button> --></p>
</div>
<div class="langcontent code interface python">
  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#This code requires the G2S server to be running
</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">g2s</span> <span class="kn">import</span> <span class="n">g2s</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># load example training image ('stone')
</span><span class="n">ti</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">).</span><span class="n">content</span><span class="p">)));</span>


<span class="c1"># asynchronous QS call using G2S with the "-submitOnly" flag
</span><span class="n">jobid_1</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span> 
                 <span class="s">'-submitOnly'</span><span class="p">,</span>
                 <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                 <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                 <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                 <span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1"># second asynchronous call that waits for job 1 to finish using the "-after" flag
</span><span class="n">jobid_2</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span> 
                  <span class="s">'-after'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">,</span>
                  <span class="s">'-submitOnly'</span><span class="p">,</span>
                  <span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span>
                  <span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span>
                  <span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span>
                  <span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>
                  <span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1"># check the status of both jobs in 2-second intervals using the "-statusOnly" flag
</span><span class="n">status_1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">status_2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">status_2</span> <span class="o">&lt;</span> <span class="mi">95</span><span class="p">:</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">status_1</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-statusOnly'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">)</span>
    <span class="n">status_2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-statusOnly'</span><span class="p">,</span><span class="n">jobid_2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Status jobs 1 &amp; 2:   '</span><span class="p">,</span> <span class="n">status_1</span><span class="p">,</span><span class="n">status_2</span><span class="p">)</span>

<span class="c1"># retrieve the simulation results from the server using the "-waitAndDownload" flag
# if the simulation would not be ready yet this call would wait for it to be ready
</span><span class="n">sim1</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-waitAndDownload'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">)</span>
<span class="n">sim2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">g2s</span><span class="p">(</span><span class="s">'-waitAndDownload'</span><span class="p">,</span><span class="n">jobid_2</span><span class="p">)</span>

<span class="c1"># display results 
</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'QS Unconditional simulation'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s">'xx-large'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Training image'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim1</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation 1'</span><span class="p">);</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim2</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Simulation 2'</span><span class="p">);</span>
<span class="n">ax3</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div>  </div>
</div>
<div class="langcontent code interface matlab">
  <div class="language-matlab highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">%This code requires the G2S server to be running</span>

<span class="c1">% load example traning image ('stone')</span>
<span class="n">ti</span><span class="o">=</span><span class="nb">imread</span><span class="p">(</span><span class="s1">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/stone.tiff'</span><span class="p">);</span>

<span class="c1">% asynchronous QS call using G2S with the "-submitOnly" flag</span>
<span class="n">jobid_1</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-submitOnly'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">% 2nd async call that waits for job 1 to finish using the "-after" flag</span>
<span class="n">jobid_2</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-a'</span><span class="p">,</span><span class="s1">'qs'</span><span class="p">,</span><span class="s1">'-after'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">,</span><span class="s1">'-submitOnly'</span><span class="p">,</span><span class="s1">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s1">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="s1">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="s1">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s1">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s1">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>

<span class="c1">% check the status of both jobs in 2-second intervals using the</span>
<span class="c1">% "-statusOnly" flag</span>
<span class="n">status_1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">status_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="n">status_2</span> <span class="o">&lt;</span> <span class="mi">95</span>
    <span class="nb">pause</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">status_1</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-statusOnly'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">);</span>
    <span class="n">status_2</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-statusOnly'</span><span class="p">,</span><span class="n">jobid_2</span><span class="p">);</span>
    <span class="nb">fprintf</span><span class="p">(</span><span class="s1">'Status jobs 1 &amp; 2:   %s %s\n'</span><span class="p">,</span> <span class="n">status_1</span><span class="p">,</span> <span class="n">status_2</span><span class="p">);</span>
<span class="k">end</span>

<span class="c1">% retrieve the simulation results from the server using the</span>
<span class="c1">%"-waitAndDownload" flag. If the simulation would not be ready yet this</span>
<span class="c1">%call would wait for it to be ready</span>
<span class="n">sim1</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-waitAndDownload'</span><span class="p">,</span><span class="n">jobid_1</span><span class="p">);</span>
<span class="n">sim2</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s1">'-waitAndDownload'</span><span class="p">,</span><span class="n">jobid_2</span><span class="p">);</span>

<span class="c1">% display results</span>
<span class="nb">sgtitle</span><span class="p">(</span><span class="s1">'Unconditional asynchronous simulation'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">ti</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Training image'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">sim1</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation 1'</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">sim2</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'Simulation 2'</span><span class="p">);</span>



</code></pre></div>  </div>
</div>

<h2 id="publication">
<a class="anchor" href="#publication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publication</h2>

<p><em>Gravey, M., &amp; Mariethoz, G. (2020). QuickSampling v1.0: a robust and simplified pixel-based multiple-point simulation approach. Geoscientific Model Development, 13(6), 2611–2630. https://doi.org/10.5194/gmd-13-2611-2020</em></p>

<h2 id="benchmarking">
<a class="anchor" href="#benchmarking" aria-hidden="true"><span class="octicon octicon-link"></span></a>Benchmarking</h2>

<p>This code CAN be used for benchmarking (and I invite you to do so 😉), the code needs to run natively on macOS or on Linux using the Intel Compiler with MKL library. The version needs to be reported, and the time needs to be the time reported by the algorithm (that is the true execution time without taking into account interfaces overhead).</p>

<p>When benchmarking, the code should NOT be used inside a Virtual Machine or through WSL on Windows 10+.</p>

<h2 id="advanced">
<a class="anchor" href="#advanced" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced</h2>

<p>This page provides some additional information on how to do common tasks. It also serves as personal note to myself 😁</p>

<h3 id="multiple-realization">
<a class="anchor" href="#multiple-realization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiple realization</h3>

<p>A question that is frequently asked is how to do multiple realizations. Currently there are three different ways to do it, each one of them has pros and cons.</p>

<h4 id="the-lazy-solution">The lazy solution</h4>

<p>The simplest solution is to do a for-loop over the realizations. However, in each step the algorithm needs to wait for the data to load, and this creates an overhead</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sims1</span><span class="o">=</span><span class="n">numpy</span><span class="p">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="n">numberOfSimulation</span><span class="p">));</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfSimulation</span><span class="p">):</span>
  <span class="n">sims1</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-sa'</span><span class="p">,</span><span class="n">computationServer</span><span class="p">,</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-s'</span><span class="p">,</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="for-loop-without-overhead">For-loop without overhead</h4>

<p>By using the G2S submission queue, it’s possible to remove most of the overhead. This is the most versatile solution and it is recommended over the first solution, especially in case the computations are run on another machine. Furthermore, in this solution the parameters can be changed for each realization.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds</span><span class="o">=</span><span class="n">numpy</span><span class="p">.</span><span class="n">empty</span><span class="p">((</span><span class="n">numberOfSimulation</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'long'</span><span class="p">);</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfSimulation</span><span class="p">):</span>
  <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-sa'</span><span class="p">,</span><span class="n">computationServer</span><span class="p">,</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-s'</span><span class="p">,</span><span class="mi">100</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="s">'-submitOnly'</span><span class="p">);</span>

<span class="n">sims2</span><span class="o">=</span><span class="n">numpy</span><span class="p">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="n">numberOfSimulation</span><span class="p">));</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfSimulation</span><span class="p">):</span>
  <span class="n">sims2</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-sa'</span><span class="p">,</span><span class="n">computationServer</span><span class="p">,</span><span class="s">'-waitAndDownload'</span><span class="p">,</span><span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</code></pre></div></div>

<h4 id="overdimensioning-of-the-destination-image">Overdimensioning of the destination image</h4>

<p>This is the third solution to get multiple simulations at once. Although this solution looks easier, it has more limitations (e.g., being limited same size, same parameters, etc.), and therefore it is ⚠️ <strong>not guaranteed</strong> to stay functional in the future. This last solution should only be considered in case of extremely parallelized simulations (number of threads &gt;50) and/or extremely small simulations (less than 1e4 pixels per simulation)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sims3</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-sa'</span><span class="p">,</span><span class="n">computationServer</span><span class="p">,</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numberOfSimulation</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">))</span><span class="o">*</span><span class="n">numpy</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">numpy</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="how-to-do-a-simulation-by-segment">
<a class="anchor" href="#how-to-do-a-simulation-by-segment" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to do a simulation by segment</h3>

<p>Although QS tends to reduce issues related to non-stationarity, it won’t remove them completely. Therefore in cases with high non-stationarity, the challenge is to respect each zone separately. Here we assume that we have different training images for each specific zone.</p>

<h4 id="using-a-secondary-variable">Using a secondary variable</h4>

<p>The first solution for doing a simulation by segment is to add a secondary variable with the information of non-stationarity. In this case the setting of the algorithm has to be identical for both training images.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ti1</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/bangladesh.tiff'</span><span class="p">);</span>
<span class="n">ti2</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/strebelle.tiff'</span><span class="p">);</span>

<span class="n">dt</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">;</span>

<span class="n">ti1_bis</span><span class="o">=</span><span class="n">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ti1</span><span class="p">,</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">ti1</span><span class="p">)));</span>
<span class="n">ti2_bis</span><span class="o">=</span><span class="n">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ti2</span><span class="p">,</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">ti2</span><span class="p">)));</span>

<span class="n">localKernel</span><span class="o">=</span><span class="n">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="n">padarray</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">25</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]));</span>
<span class="o">%</span> <span class="n">localKernel</span><span class="o">=</span><span class="n">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="n">kernel</span><span class="p">);</span>

<span class="n">sim</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti1_bis</span><span class="p">,</span><span class="n">ti2_bis</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">cat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">tiSelection</span><span class="p">)),</span><span class="n">tiSelection</span><span class="p">),</span><span class="s">'-dt'</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-ki'</span><span class="p">,</span><span class="n">localKernel</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">medfilt2</span><span class="p">(</span><span class="n">sim</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">drawnow</span><span class="p">;</span>
<span class="n">pause</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="using-training-image-indices">Using training image indices</h4>
<p>The second solution for doing a simulation by segment is to use a training image index map. This requires that each training image represents a stationary subdomain. Also in this case the setting of the algorithm needs to be identical between training images.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">ti1</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/bangladesh.tiff'</span><span class="p">);</span>
<span class="n">ti2</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/strebelle.tiff'</span><span class="p">);</span>

<span class="n">dt</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">;</span>

<span class="n">sim</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti1</span><span class="p">,</span><span class="n">ti2</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">tiSelection</span><span class="p">)),</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-ki'</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="s">'-ii'</span><span class="p">,</span><span class="n">tiSelection</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">medfilt2</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span>
<span class="n">pause</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="the-optimal-solution">The optimal solution</h4>

<p>Using the <code class="language-plaintext highlighter-rouge">-ni</code> and <code class="language-plaintext highlighter-rouge">-kii</code> …
TODO!!</p>

<h4 id="simulating-each-subdomain-sequentially">Simulating each subdomain sequentially</h4>
<p>The last solution for doing a simulation by segment is to do simulations per subdomain. This allows for changing the settings between each subdomain. However each subdomain is simulated sequentially and therefore can be at the origin of some artifacts, regarding the order of simulations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ti1</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/bangladesh.tiff'</span><span class="p">);</span>
<span class="n">ti2</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="s">'https://raw.githubusercontent.com/GAIA-UNIL/TrainingImagesTIFF/master/strebelle.tiff'</span><span class="p">);</span>

<span class="n">dt</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">N</span><span class="o">=</span><span class="mi">300</span><span class="p">;</span>

<span class="n">path</span><span class="o">=</span><span class="n">reshape</span><span class="p">(</span><span class="n">randperm</span><span class="p">(</span><span class="n">numel</span><span class="p">(</span><span class="n">tiSelection</span><span class="p">)),</span><span class="n">size</span><span class="p">(</span><span class="n">tiSelection</span><span class="p">));</span>
<span class="n">p1</span><span class="o">=</span><span class="n">path</span><span class="p">;</span>
<span class="n">p1</span><span class="p">(</span><span class="n">tiSelection</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">=-</span><span class="n">inf</span><span class="p">;</span>
<span class="n">p2</span><span class="o">=</span><span class="n">path</span><span class="p">;</span>
<span class="n">p2</span><span class="p">(</span><span class="n">tiSelection</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">=-</span><span class="n">inf</span><span class="p">;</span>
<span class="n">sim</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti1</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">nan</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">tiSelection</span><span class="p">)),</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-ki'</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="s">'-sp'</span><span class="p">,</span><span class="n">p1</span><span class="p">);</span>
<span class="n">sim</span><span class="o">=</span><span class="n">g2s</span><span class="p">(</span><span class="s">'-a'</span><span class="p">,</span><span class="s">'qs'</span><span class="p">,</span><span class="s">'-ti'</span><span class="p">,</span><span class="n">ti2</span><span class="p">,</span><span class="s">'-di'</span><span class="p">,</span><span class="n">sim</span><span class="p">,</span><span class="s">'-dt'</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="s">'-n'</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">'-k'</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="s">'-j'</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">'-ki'</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="s">'-sp'</span><span class="p">,</span><span class="n">p2</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">medfilt2</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span>
<span class="n">pause</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>


        </section>
      </div>
    </div>
    <footer>
       
            <p class="repo-owner"><a href="https://github.com/GAIA-UNIL/G2S">G2S</a> is actively maintained by <a href="https://wp.unil.ch/gaia/">GAIA lab</a> at the <a href="https://www.unil.ch">University of Lausanne</a> and the <a href="https://www.oeaw.ac.at/igf">IGF</a> at the <a href="https://www.oeaw.ac.at/">Austrian Academy of Sciences</a>.</p>
          
    </footer>
  </body>
</html>